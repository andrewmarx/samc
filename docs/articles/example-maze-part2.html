<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maze Part 2 • samc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Maze Part 2">
<meta property="og:description" content="samc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">samc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/article-circuit-theory.html">Circuit Theory</a>
    </li>
    <li>
      <a href="../articles/performance.html">Performance</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel Computing</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/code-snippets.html">Code Snippets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-disconnected.html">Disconnected Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial-basic.html">Basic Tutorial</a>
    </li>
    <li>
      <a href="../articles/tutorial-locations.html">Locations</a>
    </li>
    <li>
      <a href="../articles/tutorial-ggplot.html">ggplot Visualization</a>
    </li>
    <li>
      <a href="../articles/tutorial-temporal.html">Temporal Analysis</a>
    </li>
    <li>
      <a href="../articles/tutorial-animations.html">Animations</a>
    </li>
    <li>
      <a href="../articles/tutorial-multiple-absorption.html">Multiple Absorption</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-coinflip.html">Coin Flip</a>
    </li>
    <li>
      <a href="../articles/example-maze-part1.html">Maze (Part 1)</a>
    </li>
    <li>
      <a href="../articles/example-maze-part2.html">Maze (Part 2)</a>
    </li>
    <li>
      <a href="../articles/example-maze-part3.html">Maze (Part 3)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrewmarx/samc" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Maze Part 2</h1>
                        <h4 data-toc-skip class="author">Andrew
Marx</h4>
            
            <h4 data-toc-skip class="date">2022-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewmarx/samc/blob/HEAD/vignettes/example-maze-part2.Rmd" class="external-link"><code>vignettes/example-maze-part2.Rmd</code></a></small>
      <div class="hidden name"><code>example-maze-part2.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="example-maze-part1.html">Part 1</a> of this series explored
the applications of absorbing Markov chains in the context of a simple
perfect maze. This part of the series will expand on the simple maze in
various ways and explore how these changes affect interpretations of the
different metrics offered in the samc package.</p>
<p>The complete code for this series is available on <a href="https://github.com/andrewmarx/samc/blob/main/vignettes/scripts/example-maze.R" class="external-link">Github</a>.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Part 2 reuses the code from <a href="example-maze-part2.html">Part
1</a>.</p>
</div>
<div class="section level2">
<h2 id="fidelity">Fidelity<a class="anchor" aria-label="anchor" href="#fidelity"></a>
</h2>
<p>The first change explored in this part will be the incorporation of
fidelity into the samc object. In Part 1, transitions always occurred
from one cell to a different neighboring cell. With fidelity,
transitions can occur from a cell to itself; essentially, there’s no
movement over the course of a time step. There are potentially many
different ways that fidelity could be applied to the maze, but for
simplicity, this example will keep things simple by using it to create a
delay in movement at intersections. The goal is to model “hesitation”
when an individual is presented with the choice of three or more paths.
For additional simplicity, all intersections will be treated the same
and assigned a fidelity probability of <code>0.1</code>, which means
that once an individual is at an intersection, there is a 10%
probability that they will stay in the intersection from one time step
to the next.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Intersections determined using a moving window function</span></span>
<span><span class="va">ints_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">maze_res</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">}</span>, pad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ints_res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">maze_res</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">ints_res</span> <span class="op">&lt;-</span> <span class="va">ints_res</span> <span class="op">*</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">ints_res</span>, <span class="st">"Intersections"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Fidelity changes the <span class="math inline">\(P\)</span> matrix
underlying the samc object, which means that the samc object has to be
recreated:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ints_samc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/samc.html">samc</a></span><span class="op">(</span><span class="va">maze_res</span>, <span class="va">maze_finish</span>, <span class="va">ints_res</span>, tr_args <span class="op">=</span> <span class="va">tr</span><span class="op">)</span></span></code></pre></div>
<p>To start, let’s see how the new fidelity input affects the expected
time to finish:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original results from Part 1</span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span><span class="op">)</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 13869</span></span>
<span><span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_origin</span>, <span class="va">maze_dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13868</span></span>
<span></span>
<span><span class="co"># Results with fidelity at intersections</span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">ints_samc</span><span class="op">)</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 14356</span></span>
<span><span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">ints_samc</span>, <span class="va">maze_origin</span>, <span class="va">maze_dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 14355</span></span></code></pre></div>
<p>Intuitively, with “hesitation” added to the movement, the expected
time to finish increases. Also note that incorporating fidelity in this
particular example does not affect the relationship between
<code><a href="../reference/survival.html">survival()</a></code> and <code><a href="../reference/cond_passage.html">cond_passage()</a></code>.</p>
<p>In terms of the probability of visiting any particular cell, changing
the fidelity does not change the results from Part 1:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ints_disp <span class="ot">&lt;-</span> <span class="fu">dispersal</span>(ints_samc, <span class="at">origin =</span> maze_origin)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cached diagonal not found.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Performing setup. This can take several minutes... Complete.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating matrix inverse diagonal...</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>Computing<span class="sc">:</span> <span class="dv">100</span>% (done)                         </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>Complete                                                      </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Diagonal has been cached. Continuing with metric calculation...</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(maze_disp, ints_disp)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Fidelity does, however, change the number of times each cell is
expected to be visited:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ints_visit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visitation.html">visitation</a></span><span class="op">(</span><span class="va">ints_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">maze_visit</span>, <span class="va">ints_visit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Mean relative difference: 0.03511428"</span></span>
<span></span>
<span><span class="co"># Let's plot the difference to see if there is a noticeable pattern</span></span>
<span><span class="va">visit_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">ints_visit</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_visit</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">visit_diff</span>, <span class="st">"Visits Per Cell (Difference)"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>With fidelity present, the intersections are seeing a significantly
different number of visits. Since a “visit” effectively represents a
transition to a cell from one time step to the next, the presence of
fidelity means that the metric is counting transitions from a cell to
itself as well. Interestingly, when compared to the figure in Part 1,
the legend in this figure seems to indicate that the increase for the
intersections might be 10%, or the same as the fidelity probabilities.
It also seems like the non-intersections (cells with a fidelity
probability of <code>0.0</code>) experienced no change. Let’s check
these ideas:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, let's see which cells changed.</span></span>
<span><span class="co"># Ideally would just use `visit_diff &gt; 0`, but floating point precision issues force an approximation</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">visit_diff</span> <span class="op">&gt;</span> <span class="va">tolerance</span>, <span class="st">"Visits With Non-Zero Difference"</span>, <span class="va">vir_col</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Second, let's see what the percent change is for our non-zero differences.</span></span>
<span><span class="va">visit_perc</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ints_visit</span> <span class="op">-</span> <span class="va">maze_visit</span><span class="op">)</span> <span class="op">/</span> <span class="va">maze_visit</span></span>
<span><span class="va">visit_perc</span><span class="op">[</span><span class="va">visit_perc</span><span class="op">&gt;</span><span class="va">tolerance</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111</span></span>
<span><span class="co">#&gt;  [8] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111</span></span>
<span><span class="co">#&gt; [15] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111</span></span>
<span><span class="co">#&gt; [22] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111</span></span>
<span><span class="co">#&gt; [29] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111</span></span>
<span><span class="co">#&gt; [36] 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111</span></span>
<span><span class="co">#&gt; [43] 0.1111111</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;"></p>
<p>It turns out that there is no change in the number of expected visits
for non-intersections. It also turns out that our hunch for the
intersections was only partially true; the change is constant, but it’s
1/9 instead of 0.1 or 10%.</p>
<p>The most interesting change from incorporating fidelity might be with
the <code><a href="../reference/distribution.html">distribution()</a></code> metric. Recall from Part 1 that there
was an alternating pattern with the cells when changing the time steps.
With fidelity, this effect still exists, but not to the same degree:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ints_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">ints_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">ints_samc</span>, <span class="va">ints_dist</span><span class="op">)</span>, <span class="st">"Location at t=20"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ints_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">ints_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">ints_samc</span>, <span class="va">ints_dist</span><span class="op">)</span>, <span class="st">"Location at t=21"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"><img src="example-maze-part2_files/figure-html/unnamed-chunk-8-2.png" width="672" style="display: block; margin: auto;"></p>
<p>Given a sufficient amount of time, the cumulative effect of having
fidelity present will almost entirely eliminate this pattern. Even from
time steps 200-201, the alternating pattern is visually nearly gone:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ints_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">ints_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">ints_samc</span>, <span class="va">ints_dist</span><span class="op">)</span>, <span class="st">"Location at t=200"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ints_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">ints_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">201</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">ints_samc</span>, <span class="va">ints_dist</span><span class="op">)</span>, <span class="st">"Location at t=201"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"><img src="example-maze-part2_files/figure-html/unnamed-chunk-9-2.png" width="672" style="display: block; margin: auto;"></p>
<p>For comparison, here’s the original samc object using the same time
steps:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">maze_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_dist</span><span class="op">)</span>, <span class="st">"Location at t=200"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">maze_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">maze_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">201</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_dist</span><span class="op">)</span>, <span class="st">"Location at t=201"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"><img src="example-maze-part2_files/figure-html/unnamed-chunk-10-2.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="dead-end-avoidance">Dead End Avoidance<a class="anchor" aria-label="anchor" href="#dead-end-avoidance"></a>
</h2>
<p>Technically, the package doesn’t offer the ability to “look ahead” at
future states to adjust the transition probabilities. In other words, if
a route would eventually lead to a dead end, there’s nothing in the
<code><a href="../reference/samc.html">samc()</a></code> function or the metric functions to account for that
or model the possibility that an individual in the maze can see down a
hallway. It can, however, be faked somewhat by adjusting the resistance
map so that the dead ends have a much higher resistance. This will
reduce the probability of an individual entering a dead end, almost as
if they looked ahead. A sliding window function can be used to create
this new map:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Dead ends</span></span>
<span><span class="va">ends_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">maze_res</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">}</span>, pad <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ends_res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">maze_res</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">ends_res</span> <span class="op">&lt;-</span> <span class="va">ends_res</span> <span class="op">*</span> <span class="fl">9</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">ends_res</span><span class="op">[</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">ends_res</span>, <span class="st">"Dead Ends"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The dead ends have been assigned a resistance value of
<code>10</code>, which is relatively high and means that dead ends will
only rarely be entered. Since the resistance map has been modified, the
samc object will need to be recreated. The fidelity data from the
previous section will not be used, which will allow direct comparisons
against the model created in Part 1.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ends_samc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/samc.html">samc</a></span><span class="op">(</span><span class="va">ends_res</span>, <span class="va">maze_finish</span>, tr_args <span class="op">=</span> <span class="va">tr</span><span class="op">)</span></span></code></pre></div>
<p>Hypothetically, since an individual can now “look ahead”, they should
be able to get through the maze faster because they are spending less
time in dead ends. This is easily verified:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original results from Part 1</span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span><span class="op">)</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 13869</span></span>
<span><span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_origin</span>, <span class="va">maze_dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13868</span></span>
<span></span>
<span><span class="co"># Results with dead ends</span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">ends_samc</span><span class="op">)</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 11313</span></span>
<span><span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">ends_samc</span>, <span class="va">maze_origin</span>, <span class="va">maze_dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 11312</span></span></code></pre></div>
<p>Since the dead ends have a lower probability of being transitioned
to, the <code><a href="../reference/dispersal.html">dispersal()</a></code> and <code><a href="../reference/visitation.html">visitation()</a></code> metrics
should obviously reflect that:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ends_disp <span class="ot">&lt;-</span> <span class="fu">dispersal</span>(ends_samc, <span class="at">origin =</span> maze_origin)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cached diagonal not found.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Performing setup. This can take several minutes... Complete.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating matrix inverse diagonal...</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>Computing<span class="sc">:</span> <span class="dv">100</span>% (done)                         </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>Complete                                                      </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Diagonal has been cached. Continuing with metric calculation...</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_maze</span>(<span class="fu">map</span>(maze_samc, ends_disp), <span class="st">"Probability of Visit"</span>, <span class="fu">viridis</span>(<span class="dv">256</span>))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>ends_visit <span class="ot">&lt;-</span> <span class="fu">visitation</span>(ends_samc, <span class="at">origin =</span> maze_origin)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_maze</span>(<span class="fu">map</span>(maze_samc, ends_visit), <span class="st">"Visits Per Cell"</span>, <span class="fu">viridis</span>(<span class="dv">256</span>))</span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"><img src="example-maze-part2_files/figure-html/unnamed-chunk-14-2.png" width="672" style="display: block; margin: auto;"></p>
<p>The effect is more obvious with the expected number of visits from
<code><a href="../reference/visitation.html">visitation()</a></code>; the probability illustration is more subtle
compared to the original results in Part 1. This could be explored
similarly to how some of the differences in the fidelity section are
illustrated, an exercise that will be left to interested readers.</p>
</div>
<div class="section level2">
<h2 id="traps">Traps<a class="anchor" aria-label="anchor" href="#traps"></a>
</h2>
<p>It’s fairly to trivial to add lethal traps to the maze by updating
the absorption input to the <code><a href="../reference/samc.html">samc()</a></code> function. The key thing
to keep in mind is that the <code><a href="../reference/samc.html">samc()</a></code> function expects the
<em>total</em> absorption, so it will only be provided a single
absorption input. However, the package can be used to tease apart the
role that different sources of absorption will have in the model. There
are two different approaches to setting this up:</p>
<ol style="list-style-type: decimal">
<li>Start with a single total absorption input. Then take that input and
decompose it into multiple absorption components.</li>
<li>Start with multiple absorption components. Then take those inputs
and combine them into a single total absorption input.</li>
</ol>
<p>The choice really depends on the data available and the goals of the
project. For example, the first strategy is useful if we’ve somehow
measured total absorption for a model and want to explore different
hypotheses for how it breaks down into different types of absorption.
The second is useful if we already have direct knowledge of different
sources of absorption.</p>
<p>This example will take the second approach. One absorption component
has already been created for finish point. A second simple absorption
component will created that represents a few traps with a
<code>0.2</code> or 20% absorption probability:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Traps absorption layer</span></span>
<span><span class="va">maze_traps</span> <span class="op">&lt;-</span> <span class="va">maze_res</span> <span class="op">*</span> <span class="fl">0</span></span>
<span><span class="va">maze_traps</span><span class="op">[</span><span class="fl">17</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="va">maze_traps</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="va">maze_traps</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">maze_traps</span>, <span class="st">"Traps"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Since the total absorption is the sum of these two components, the
samc object will have to be recreated:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_abs_total</span> <span class="op">&lt;-</span> <span class="va">maze_finish</span> <span class="op">+</span> <span class="va">maze_traps</span></span>
<span></span>
<span><span class="va">traps_samc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/samc.html">samc</a></span><span class="op">(</span><span class="va">maze_res</span>, <span class="va">maze_abs_total</span>, tr_args <span class="op">=</span> <span class="va">tr</span><span class="op">)</span></span></code></pre></div>
<p>For easy comparison, everything else will be kept the same as the
original example from Part 1. Continuing the previous strategy, let’s
start with determining how long it is expected for an individual to
finish the maze:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Original results from Part 1</span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span><span class="op">)</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 13869</span></span>
<span><span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_origin</span>, <span class="va">maze_dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13868</span></span>
<span></span>
<span><span class="co"># Results with traps</span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">traps_samc</span><span class="op">)</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1330.26</span></span>
<span><span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">traps_samc</span>, <span class="va">maze_origin</span>, <span class="va">maze_dest</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3060.207</span></span></code></pre></div>
<p>The results are drastically different from what has been seen before.
First, the clear relationship between <code><a href="../reference/survival.html">survival()</a></code> and
<code><a href="../reference/cond_passage.html">cond_passage()</a></code> no longer exists. This is because
<code><a href="../reference/survival.html">survival()</a></code> has a different interpretation in this context
and no longer determines how long it will take to finish; instead it now
calculates how long it will take an individual to either finish
<em>or</em> be absorbed in one of the traps (i.e., die). This also
drastically changes the plotting results of <code><a href="../reference/survival.html">survival()</a></code>
(note the change in figure title from Part 1 to reflect the new
interpretation):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traps_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">traps_samc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note the updated title from part 1</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">traps_surv</span><span class="op">)</span>, <span class="st">"Expected Time to Absorption"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The results are also drastically different from Part 1 when looking
at visitation probability and number of visits:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>traps_disp <span class="ot">&lt;-</span> <span class="fu">dispersal</span>(traps_samc, <span class="at">origin =</span> maze_origin)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cached diagonal not found.</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Performing setup. This can take several minutes... Complete.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating matrix inverse diagonal...</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>Computing<span class="sc">:</span> <span class="dv">100</span>% (done)                         </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>Complete                                                      </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Diagonal has been cached. Continuing with metric calculation...</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_maze</span>(<span class="fu">map</span>(traps_samc, traps_disp), <span class="st">"Probability of Visit"</span>, <span class="fu">viridis</span>(<span class="dv">256</span>))</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>traps_visit <span class="ot">&lt;-</span> <span class="fu">visitation</span>(traps_samc, <span class="at">origin =</span> maze_origin)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_maze</span>(<span class="fu">map</span>(traps_samc, traps_visit), <span class="st">"Visits Per Cell"</span>, <span class="fu">viridis</span>(<span class="dv">256</span>))</span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;"><img src="example-maze-part2_files/figure-html/unnamed-chunk-19-2.png" width="672" style="display: block; margin: auto;"></p>
<p>Importantly, the technique in Part 1 of using visitation
probabilities of <code>1.0</code> to identify the route through the maze
will not work in this example; it only works in very specialized cases.
The reason is simple: since an individual can now be absorbed in other
locations, there is a non-zero probability that they never reach the
finish, which in turn means the probability of visiting the finish is
now less than 1.0. However, the same technique can be used to see
something interesting:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ideally, we would just use `as.numeric(traps_disp == 1)`, but we have floating point precision issues here, so we will approximate it</span></span>
<span><span class="va">traps_disp_route</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">traps_disp</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tolerance</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">traps_samc</span>, <span class="va">traps_disp_route</span><span class="op">)</span>, <span class="st">"dispersal() == 1"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-20-1.png" width="672" style="display: block; margin: auto;"></p>
<p>It shows part of the solution observed before, but only up to the
first maze intersection that leads to two or more possible sources of
absorption.</p>
</div>
<div class="section level2">
<h2 id="addtional-metrics">Addtional metrics<a class="anchor" aria-label="anchor" href="#addtional-metrics"></a>
</h2>
<p>The inclusion of multiple absorption states makes the metrics that
were not useful of Part 1 more relevant. Starting with
<code><a href="../reference/mortality.html">mortality()</a></code>, it is possible to visualize where an
individual is expected to be absorbed:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traps_mort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mortality.html">mortality</a></span><span class="op">(</span><span class="va">traps_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">traps_samc</span>, <span class="va">traps_mort</span><span class="op">)</span>, <span class="st">"Absorption Probability"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This result is quite possibly unexpected. Why does the finish point
look like it’s <code>0</code>? Looking at the numbers might provide
insight:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traps_mort</span><span class="op">[</span><span class="va">traps_mort</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="co">#&gt;           5          65         170         215 </span></span>
<span><span class="co">#&gt; 0.852084306 0.113761093 0.003940915 0.030213685</span></span>
<span></span>
<span><span class="va">traps_mort</span><span class="op">[</span><span class="va">maze_dest</span><span class="op">]</span></span>
<span><span class="co">#&gt;        215 </span></span>
<span><span class="co">#&gt; 0.03021369</span></span></code></pre></div>
<p>There’s only a 3.0% chance of an individual finishing the maze! This
might seem low given the traps are only lethal 20% of the time, but it
actually makes sense. Recall the <a href="example-maze-part1.html#probability-of-visiting-a-cell-1">Probability
of visiting a cell</a> and <a href="example-maze-part1.html#visits-per-cell-1">Visits per cell</a>
sections from Part 1; an individual spends most of their time in the
early part of the maze. That means they have a lot more exposure to the
first trap and, consequently, are more likely to be absorbed there with
a 85.2% probability. For the trap farthest from the start, reaching it
first requires passing by the finish, so consequently it has only a
0.39% of being the source of absorption, a substantially lower
probability than just finishing the maze.</p>
<p>It is possible to break down the total absorption so that the role of
different sources of absorption can be investigated more easily. Now
that the samc object has been created, it can be provided the original
absorption layers that were used to calculate the total absorption:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Naming the rasters will make things easier and less prone to user error later</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">maze_finish</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Finish"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">maze_traps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Traps"</span></span>
<span></span>
<span><span class="va">traps_samc</span><span class="op">$</span><span class="va">abs_states</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html" class="external-link">stack</a></span><span class="op">(</span><span class="va">maze_finish</span>, <span class="va">maze_traps</span><span class="op">)</span></span></code></pre></div>
<p>By doing so, the <code><a href="../reference/mortality.html">mortality()</a></code> metric now returns a list
with information about not just the total absorption, but the individual
components as well. This allows the role of different types of
absorption to be individually accessed and visualized:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traps_mort_dec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mortality.html">mortality</a></span><span class="op">(</span><span class="va">traps_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">traps_mort_dec</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ total : Named num [1:215] 0 0 0 0 0.852 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:215] "1" "2" "3" "4" ...</span></span>
<span><span class="co">#&gt;  $ Finish: Named num [1:215] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:215] "1" "2" "3" "4" ...</span></span>
<span><span class="co">#&gt;  $ Traps : Named num [1:215] 0 0 0 0 0.852 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "names")= chr [1:215] "1" "2" "3" "4" ...</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">traps_samc</span>, <span class="va">traps_mort_dec</span><span class="op">$</span><span class="va">Finish</span><span class="op">)</span>, <span class="st">"Absorption Probability (Finish)"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">traps_samc</span>, <span class="va">traps_mort_dec</span><span class="op">$</span><span class="va">Traps</span><span class="op">)</span>, <span class="st">"Absorption Probability (Traps)"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part2_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;"><img src="example-maze-part2_files/figure-html/unnamed-chunk-24-2.png" width="672" style="display: block; margin: auto;"></p>
<p>With multiple sources of absorption now specified in the samc object,
the <code><a href="../reference/absorption.html">absorption()</a></code> metric becomes relevant:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/absorption.html">absorption</a></span><span class="op">(</span><span class="va">traps_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Finish      Traps </span></span>
<span><span class="co">#&gt; 0.03021369 0.96978631</span></span></code></pre></div>
<p>The output from this is quite simple: it is the probability that an
individual will experience a particular type of absorption. As seen
before, there is a 3.0% chance of finishing the maze. But
<code><a href="../reference/absorption.html">absorption()</a></code> also shows that there is a 97.0% total
probability that absorption will occur in one of the three traps. This
is different from the <code><a href="../reference/mortality.html">mortality()</a></code> metric, which calculates
the absorption probabilities at each cell. There is clearly a
relationship between the two metrics, and the advantage of this example
is that it’s easy to see it; it is more difficult to see how the two
metrics are related in more complex situations.</p>
</div>
<div class="section level2">
<h2 id="part-3">Part 3<a class="anchor" aria-label="anchor" href="#part-3"></a>
</h2>
<p>The next part of this example series will take the maze with only a
single solution and modify it with a “secret” shortcut. Wrapping up this
example, Part 3 will then take all of the changes introduced in the
series and combine them into a single final example.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew Marx.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
