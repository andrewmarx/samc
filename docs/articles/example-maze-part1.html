<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maze Part 1 • samc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Maze Part 1">
<meta property="og:description" content="samc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">samc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/article-circuit-theory.html">Circuit Theory</a>
    </li>
    <li>
      <a href="../articles/article-computation-methods.html">Computation Methods</a>
    </li>
    <li>
      <a href="../articles/article-models.html">Models</a>
    </li>
    <li>
      <a href="../articles/performance.html">Performance</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallel Computing</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/code-snippets.html">Code Snippets</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-disconnected.html">Disconnected Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial-basic.html">Basic Tutorial</a>
    </li>
    <li>
      <a href="../articles/tutorial-locations.html">Locations</a>
    </li>
    <li>
      <a href="../articles/tutorial-ggplot.html">ggplot Visualization</a>
    </li>
    <li>
      <a href="../articles/tutorial-temporal.html">Temporal Analysis</a>
    </li>
    <li>
      <a href="../articles/tutorial-animations.html">Animations</a>
    </li>
    <li>
      <a href="../articles/tutorial-multiple-absorption.html">Multiple Absorption</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-coinflip.html">Coin Flip</a>
    </li>
    <li>
      <a href="../articles/example-maze-part1.html">Maze (Part 1)</a>
    </li>
    <li>
      <a href="../articles/example-maze-part2.html">Maze (Part 2)</a>
    </li>
    <li>
      <a href="../articles/example-maze-part3.html">Maze (Part 3)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrewmarx/samc" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Maze Part 1</h1>
                        <h4 data-toc-skip class="author">Andrew
Marx</h4>
            
            <h4 data-toc-skip class="date">2023-05-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewmarx/samc/blob/HEAD/vignettes/example-maze-part1.Rmd" class="external-link"><code>vignettes/example-maze-part1.Rmd</code></a></small>
      <div class="hidden name"><code>example-maze-part1.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This example shows how to use and interpret different absorbing
Markov chain metrics with a <em>perfect maze</em>. A perfect maze is a
maze that has no loops, every point is reachable, and there is only a
single path between any two points. The motivation for this type of
example is that is fun and interesting while having very simple
properties that make it easy to visually and numerically interpret the
results of the different metrics available in the package.</p>
<p>The complete code for this series is available on <a href="https://github.com/andrewmarx/samc/blob/main/vignettes/scripts/example-maze.R" class="external-link">GitHub</a>.</p>
</div>
<div class="section level2">
<h2 id="libraries">Libraries<a class="anchor" aria-label="anchor" href="#libraries"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://AgrDataSci.github.io/gdistance/" class="external-link">gdistance</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrewmarx.github.io/samc/" class="external-link">samc</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/" class="external-link">viridisLite</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Create a function to reduce redundant plotting code and make the
examples easier to read:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_maze</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">map</span>, <span class="va">title</span>, <span class="va">colors</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># start = 1 (top left), finish = last element (bottom right)</span></span>
<span>  <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">map</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">map</span>, main <span class="op">=</span> <span class="va">title</span>, col <span class="op">=</span> <span class="va">colors</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.spatvector.html" class="external-link">as.polygons</a></span><span class="op">(</span><span class="va">map</span>, dissolve <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">'black'</span>, lwd <span class="op">=</span> <span class="fl">1</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">points</a></span><span class="op">(</span><span class="va">sf</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'S'</span>, <span class="st">'F'</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Create a simple color palette for when only one or two colors are
needed in a figure:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A simple color palette with 2 colors</span></span>
<span><span class="va">vir_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></code></pre></div>
<p>Setup up a resistance map representing the maze and use the
<code>gdistance</code> package to get information about the solution
(the shortest path). Assume the start is the top left and the finish is
the bottom right:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_res</span> <span class="op">&lt;-</span> <span class="fu">samc</span><span class="fu">::</span><span class="va"><a href="../reference/example_maze.html">example_maze</a></span></span>
<span></span>
<span><span class="va">maze_res</span> <span class="op">&lt;-</span> <span class="fu">samc</span><span class="fu">::</span><span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="va">maze_res</span><span class="op">)</span></span>
<span><span class="va">maze_res</span><span class="op">[</span><span class="va">maze_res</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="co"># 0 makes the formatting cleaner above, but NA is needed for true barriers</span></span>
<span></span>
<span><span class="co"># Get info about the shortest path through the maze using gdistance</span></span>
<span><span class="va">lcd</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">xyFromCell</a></span><span class="op">(</span><span class="va">maze_res</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">400</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://AgrDataSci.github.io/gdistance/reference/transition.html" class="external-link">transition</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">maze_res</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://AgrDataSci.github.io/gdistance/reference/geoCorrection.html" class="external-link">geoCorrection</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="fu">gdistance</span><span class="fu">::</span><span class="fu"><a href="https://AgrDataSci.github.io/gdistance/reference/costDistance-methods.html" class="external-link">costDistance</a></span><span class="op">(</span><span class="va">tr</span>, <span class="va">points</span><span class="op">)</span>,</span>
<span>       path <span class="op">=</span> <span class="fu"><a href="https://AgrDataSci.github.io/gdistance/reference/shortestPath.html" class="external-link">shortestPath</a></span><span class="op">(</span><span class="va">tr</span>, <span class="va">points</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>, <span class="va">points</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, output<span class="op">=</span><span class="st">"SpatialLines"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; as(&lt;dsCMatrix&gt;, "dgTMatrix") is deprecated since Matrix 1.5-0; do as(as(., "generalMatrix"), "TsparseMatrix") instead</span></span>
<span></span>
<span><span class="co"># Basic maze layout</span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">maze_res</span>, <span class="st">"Resistance"</span>, <span class="va">vir_col</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">lcd</span><span class="op">$</span><span class="va">path</span>, col <span class="op">=</span> <span class="va">vir_col</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, lw <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Create an absorption map where the finish point is the only source of
absorption. It will have an absorption value of <code>1.0</code>, which
means that once this point is entered, it cannot be left for another
cell in the maze:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># End of the maze</span></span>
<span><span class="va">maze_finish</span> <span class="op">&lt;-</span> <span class="va">maze_res</span> <span class="op">*</span> <span class="fl">0</span></span>
<span><span class="va">maze_finish</span><span class="op">[</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">maze_finish</span>, <span class="st">"Absorption"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Given the nature of some of the calculations performed by the
package, it’s sometimes possible for floating point precision issues to
arise where equality comparisons between two decimal values don’t yield
the expected results. It’s an unfortunate limitation of all computer
hardware and is why functions like <code><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal()</a></code> exist in
base R. Unfortunately, there isn’t a base function available for the
specific comparisons we want to perform, so we will manually have to do
it. To do so, we will need a tolerance value and will use the default
tolerance used by <code><a href="https://rdrr.io/pkg/terra/man/all.equal.html" class="external-link">all.equal()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tolerance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span> <span class="co"># Default tolerance in functions like all.equal()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tolerance</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.490116e-08</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-the-samc-object">Create the <code>samc</code> object<a class="anchor" aria-label="anchor" href="#create-the-samc-object"></a>
</h2>
<p>With the resistance and absorption maps prepared, a samc object can
be created:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rw_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, dir <span class="op">=</span> <span class="fl">4</span>, sym <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">maze_samc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/samc.html">samc</a></span><span class="op">(</span><span class="va">maze_res</span>, <span class="va">maze_finish</span>, model <span class="op">=</span> <span class="va">rw_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">maze_origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/locate.html">locate</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">maze_dest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/locate.html">locate</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The model represented by this samc object has been set up to assume a
simple random walk. There is no “memory” of the past to stop the
individual from going back to dead ends, there is no ability to “look
ahead” and see dead ends, and the individual will always move to a
different cell every time step.</p>
<p>Note the use of only four directions. This prevents diagonal
movements in the maze, which in turn will have important consequences
for short-term metrics (discussed later).</p>
<p>The start and finish locations are obtained from the samc object
using the <code><a href="../reference/locate.html">locate()</a></code> function. It’s important to remember
that the results from <code><a href="https://rdrr.io/pkg/terra/man/xyCellFrom.html" class="external-link">xyFromCell()</a></code> (used above for the
RasterLayer object) do <em>NOT</em> work for samc objects. Although the
results from both functions may be equivalent in certain cases, they
generally will not be equivalent and cannot be used interchangeably.</p>
</div>
<div class="section level2">
<h2 id="time-to-finish">Time to finish<a class="anchor" aria-label="anchor" href="#time-to-finish"></a>
</h2>
<p>We will start with determining how long, on average, it would be
expected for a single individual to finish the maze. Formally, the
<code><a href="../reference/survival.html">survival()</a></code> function calculates the expected time to
absorption, but since the maze has only one absorption point
representing the finish point, this means that, in this example,
<code><a href="../reference/survival.html">survival()</a></code> can be interpreted as the expected time to
finish the maze:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_surv</span><span class="op">)</span>, <span class="st">"Expected time to finish"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-8-1.png" width="672" style="display: block; margin: auto;"></p>
<p>The result is a vector with the expected time to absorption, or
finish, for every point in the maze, not just the top left start point.
The start location can be used to extract that information from the
vector:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_surv</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 13869</span></span></code></pre></div>
<p>When there is only a single point of total absorption, like in this
example, <code><a href="../reference/survival.html">survival()</a></code> and <code><a href="../reference/cond_passage.html">cond_passage()</a></code> are
nearly identical when the destination for <code><a href="../reference/cond_passage.html">cond_passage()</a></code> is
set to the point of absorption (the finish point):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_cond</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cond_passage.html">cond_passage</a></span><span class="op">(</span><span class="va">maze_samc</span>, dest <span class="op">=</span> <span class="va">maze_dest</span><span class="op">)</span></span>
<span></span>
<span><span class="va">maze_cond</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 13868</span></span></code></pre></div>
<p>It turns out that the cell in the map corresponding to our finish
point is not an absorbing state; it’s still a transient state.
Absorption occurs one time step later when the individual is removed
from the maze since it can’t go anywhere else in our example. So
<code><a href="../reference/cond_passage.html">cond_passage()</a></code> reports how long it takes to reach the final
cell, and <code><a href="../reference/survival.html">survival()</a></code> tells us how long it takes us to reach
the final cell and then be removed from it.</p>
<p>A couple of things to keep in mind: - <code><a href="../reference/survival.html">survival()</a></code> will
have different results and a different interpretation for the maze in
more complicated scenarios with multiple points of absorption. -
<code><a href="../reference/cond_passage.html">cond_passage()</a></code> normally does not work when there are states
that lead to total absorption. The only exception is when there is a
single instance of a state leading to total absorption present and the
<code>dest</code> parameter is set to it. In that case, the absorption
state is effectively ignored. This is why <code><a href="../reference/cond_passage.html">cond_passage()</a></code>
works as shown in this example, but attempting to change the
<code>dest</code> parameter to a different location will cause it to
fail. <code><a href="../reference/cond_passage.html">cond_passage()</a></code> can still be used for other
<code>dest</code> values, but first, the absorption value would have to
be changed to a value less than <code>1</code>.</p>
</div>
<div class="section level2">
<h2 id="probability-of-visiting-a-cell">Probability of visiting a cell<a class="anchor" aria-label="anchor" href="#probability-of-visiting-a-cell"></a>
</h2>
<p>If we’re interested in knowing the probability that a particular cell
(or cells) is visited at least once, then we can use the
<code><a href="../reference/dispersal.html">dispersal()</a></code> function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>maze_disp <span class="ot">&lt;-</span> <span class="fu">dispersal</span>(maze_samc, <span class="at">origin =</span> maze_origin)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cached diagonal not found.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Performing setup. This can take several minutes... Complete.</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Calculating matrix inverse diagonal...</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>Computing<span class="sc">:</span> <span class="dv">100</span>% (done)                         </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>Complete                                                      </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Diagonal has been cached. Continuing with metric calculation...</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_maze</span>(<span class="fu">map</span>(maze_samc, maze_disp), <span class="st">"Probability of Visit"</span>, <span class="fu">viridis</span>(<span class="dv">256</span>))</span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></p>
<p>To complete the maze, the individual has to visit every cell along
the path to the exit, so all of those cells will have a probability of
<code>1.0</code>. The farther away from this path a cell is located, the
lower the probability it will be visited. Additionally, the closer the
individual gets to the finish, the less likely they will spend time
taking incorrect routes before stumbling upon the finish. There’s also
the possibility of scenarios like the one where the individual is near
the finish and then manages to stumble back to the start. These
different aspects contribute to more time spent near the start point, on
average, which in turn means that cells near the start have a higher
probability of being visited.</p>
<p>The previous paragraph hinted that the results from the
<code><a href="../reference/dispersal.html">dispersal()</a></code> function can be used to identify the route
through the maze:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ideally would use `as.numeric(maze_disp == 1)`, but floating point precision issues force an approximation</span></span>
<span><span class="va">maze_disp_sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">maze_disp</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tolerance</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_disp_sol</span><span class="op">)</span>, <span class="st">"Solution Using Dispersal()"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-12-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Like the <code><a href="../reference/survival.html">survival()</a></code> function, there is an important
caveat: The visitation probabilities don’t include time <code>0</code>.
So while it looks like the starting cell might have a probability of
<code>1</code> in the first figure, it’s slightly less and it just
wasn’t apparent with the color scale:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_disp</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.9864865</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visits-per-cell">Visits per cell<a class="anchor" aria-label="anchor" href="#visits-per-cell"></a>
</h2>
<p>The package can be used to see how many times each cell in the maze
is expected to be visited on average. This is done using the
<code><a href="../reference/visitation.html">visitation()</a></code> metric:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_visit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visitation.html">visitation</a></span><span class="op">(</span><span class="va">maze_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_visit</span><span class="op">)</span>, <span class="st">"Visits Per Cell"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-14-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Since the finish point leads to total absorption, it will only be
visited once:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_visit</span><span class="op">[</span><span class="va">maze_dest</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="expected-location">Expected location<a class="anchor" aria-label="anchor" href="#expected-location"></a>
</h2>
<p>Using the <code><a href="../reference/distribution.html">distribution()</a></code> function, the location of an
individual in the maze can be predicted for a given time:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">maze_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_dist</span><span class="op">)</span>, <span class="st">"Location at t=20"</span>, col <span class="op">=</span> <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;"></p>
<p>There’s an odd pattern here that can be emphasized by incrementing
the time from 20 to 21:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">maze_samc</span>, origin <span class="op">=</span> <span class="va">maze_origin</span>, time <span class="op">=</span> <span class="fl">21</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_dist</span><span class="op">)</span>, <span class="st">"Location at t=21"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Earlier it was mentioned that using only 4 directions for the
transition function would have consequences. Without either diagonal
transitions or some form of fidelity (the possibility of an individual
not moving), there will be an alternating pattern where a cell can and
then cannot be occupied. It’s easiest to reason about the effect by
running the same function for time steps 1-5 and visualizing it, an
exercise that will be left to those interested.</p>
</div>
<div class="section level2">
<h2 id="other-metrics">Other metrics<a class="anchor" aria-label="anchor" href="#other-metrics"></a>
</h2>
<p>There are a couple of metrics that have not been covered yet:
<code><a href="../reference/absorption.html">absorption()</a></code> and <code><a href="../reference/mortality.html">mortality()</a></code>. For the example
provide thus far, they don’t do anything useful.
<code><a href="../reference/mortality.html">mortality()</a></code> would only report a 100% probability of
absorption at the finish point; it will be more useful when there are
multiple locations with absorption probabilities.
<code><a href="../reference/absorption.html">absorption()</a></code> is only useful when there are different
<em>types</em> of absorption.</p>
</div>
<div class="section level2">
<h2 id="occupancy">Occupancy<a class="anchor" aria-label="anchor" href="#occupancy"></a>
</h2>
<p>Many of the metrics offer a more advanced and flexible option for
setting an initial state in the absorbing Markov chain. Inputs to the
<code>init</code> parameter (short for initial state) can essentially be
used as an alternative to specifying a singular start point. Here is an
example <code>init</code> map that represents the scenario that has been
presented so far:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_init</span> <span class="op">&lt;-</span> <span class="va">maze_res</span> <span class="op">*</span> <span class="fl">0</span></span>
<span><span class="va">maze_init</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">maze_init</span>, <span class="st">"Occupancy"</span>, <span class="va">vir_col</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Using the <code><a href="../reference/survival.html">survival()</a></code> metric, it produces the same result
as before:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span>, init <span class="op">=</span> <span class="va">maze_init</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 13869</span></span>
<span></span>
<span><span class="va">maze_surv</span><span class="op">[</span><span class="va">maze_origin</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 13869</span></span></code></pre></div>
<p>But now, more interesting scenarios can be tested. For example, let’s
start the maze with 3 individuals:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scenario 1: 3 people start in the maze</span></span>
<span><span class="va">maze_init3</span> <span class="op">&lt;-</span> <span class="va">maze_res</span> <span class="op">*</span> <span class="fl">0</span></span>
<span><span class="va">maze_init3</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span>, init <span class="op">=</span> <span class="va">maze_init3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 41607</span></span></code></pre></div>
<p>The interpretation becomes a little trickier here. The
<code><a href="../reference/survival.html">survival()</a></code> metric is returning the cumulative time spent in
the maze for <em>all</em> the individuals. This means that with 3
individuals starting at the beginning, 3 times as much time is going to
be spent in the maze, but per individual, it will still take the same
number of time steps to finish as before:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span>, init <span class="op">=</span> <span class="va">maze_init3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span></span>
<span><span class="co">#&gt; [1] 13869</span></span></code></pre></div>
<p>Here’s a different scenario with 3 individuals again, but now they
start in different corners of the maze:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scenario 2: A person starts in each corner of the maze</span></span>
<span><span class="va">maze_init3</span> <span class="op">&lt;-</span> <span class="va">maze_res</span> <span class="op">*</span> <span class="fl">0</span></span>
<span><span class="va">maze_init3</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">maze_init3</span><span class="op">[</span><span class="fl">20</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">maze_init3</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="va">maze_init3</span>, <span class="st">"Occupancy"</span>, <span class="va">vir_col</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span>, init <span class="op">=</span> <span class="va">maze_init3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 21949</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Again, the cumulative time spent in the maze is larger than reported
in the original scenario with one individual. However, this time the
average time per individual spent in the maze decreases:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/survival.html">survival</a></span><span class="op">(</span><span class="va">maze_samc</span>, init <span class="op">=</span> <span class="va">maze_init3</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3</span></span>
<span><span class="co">#&gt; [1] 7316.333</span></span></code></pre></div>
<p>This is because the additional individuals are now located in corners
that are substantially closer to the finish point, so they would be
expected to find it faster on average. Based on where each individual
starts, it would be reasonable to expect that the individual starting in
the bottom left has the biggest advantage. One way to try and visualize
this is with the <code>distrbution()</code> metric:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">maze_init3_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distribution.html">distribution</a></span><span class="op">(</span><span class="va">maze_samc</span>, init <span class="op">=</span> <span class="va">maze_init3</span>, time <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This makes it easier to see how far along the individuals could be</span></span>
<span><span class="va">maze_init3_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">maze_init3_dist</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_maze</span><span class="op">(</span><span class="fu"><a href="../reference/map.html">map</a></span><span class="op">(</span><span class="va">maze_samc</span>, <span class="va">maze_init3_dist</span><span class="op">)</span>, <span class="st">"Location at t=17"</span>, <span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-maze-part1_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;"></p>
<p>A good exercise for the reader is to apply the concepts of the
animations vignette to this figure.</p>
</div>
<div class="section level2">
<h2 id="future-parts">Future parts<a class="anchor" aria-label="anchor" href="#future-parts"></a>
</h2>
<p>In future parts, many different modifications will be made to the
maze to explore how they change the results of different metrics and how
the different metrics are related. These modifications include the use
of fidelity to simulate scenarios where the individual pauses to think
about their next decision, modifying the resistance input to simulate
“looking ahead” to perform dead-end avoidance, and modifying the
absorption input to simulate different sources of absorption such as
lethal traps.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andrew Marx.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
